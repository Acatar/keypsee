/*! keypsee-build 2015-05-09 */
Hilary.scope("keypsee").register({name:"Callback",dependencies:["KeyInfo","console"],factory:function(a,b){"use strict";var c;return c=function(c){var d=this;c=c||{},d.key=c.key,d.keyInfo=c.keyInfo||new a,d.func=c.callback||function(a,c){b.log("event",a),b.log("keyInfo",c)},d.eventType=c.eventType}}}),Hilary.scope("keypsee").register({name:"helpers",dependencies:["utils","KeyInfo"],factory:function(a,b){"use strict";var c=function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;return r=function(){var a=this;a.registerCallback=e,a.executePasteCallback=f,a.executeCallback=h,a.getKeyInfo=k,a.getKeyInfoFromEvent=l,a.maps=c,a.dispose=function(){c.dispose(),delete a.maps,a.maps=c}},d=function(a){return a.key+"::"+a.eventType},e=function(a,b){var e,f=d(a);e=c.callbackMap[f],e?e.push(b):c.callbackMap[f]=[b]},f=function(a,b,e){var f,h;if(h=c.callbackMap[d(a)])for(f=0;f<h.length;f+=1)g(a,b,h[f],e)},g=function(b,c,d,e){a.isFunction(d.func)&&d.func(c,b,e)===!1&&(a.preventDefault(c),a.stopPropagation(c))},h=function(a,b){var e,f;if(f=c.callbackMap[d(a)])for(e=0;e<f.length;e+=1)i(a,b,f[e])},i=function(b,c,d){j(b,d.keyInfo)&&a.isFunction(d.func)&&d.func(c,b)===!1&&(a.preventDefault(c),a.stopPropagation(c))},j=function(a,b){var c,d=!1,e=b.matchAnyModifier;if(e)for(c in a.modifiers)a.modifiers.hasOwnProperty(c)&&b.modifiers.indexOf(a.modifiers[c])>-1&&(d=!0);else{if(d=!0,a.modifiers.length!==b.modifiers.length)return!1;for(c in a.modifiers)a.modifiers.hasOwnProperty(c)&&(d=b.modifiers.indexOf(a.modifiers[c])>-1?d&&!0:!1)}return d},k=function(a,d){var e,f,g,h=[];for(f=m(a),g=0;g<f.length;g+=1)e=f[g],c.aliases[e]&&(e=c.aliases[e]),d&&"keypress"!==d&&c.shiftMap[e]&&(e=c.shiftMap[e],h.push("shift")),n(e)&&h.push(e);return d=p(e,h,d),new b({key:e,modifiers:h,eventType:d})},l=function(a){"number"!=typeof a.which&&(a.which=a.keyCode);var c=q(a);if(c)return new b({key:c,modifiers:o(a),eventType:a.type})},m=function(a){return"+"===a?["+"]:a.split("+")},n=function(a){return"shift"===a||"ctrl"===a||"alt"===a||"meta"===a},o=function(a){var b=[];return a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),a.shiftKey&&b.push("shift"),b},p=function(a,b,d){return d||(d=c.getReverseMap()[a]?"keydown":"keypress"),"keypress"===d&&b.length&&(d="keydown"),d},q=function(a){if("keypress"===a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return c.map[a.which]?c.map[a.which]:c.keycodeMap[a.which]?c.keycodeMap[a.which]:String.fromCharCode(a.which).toLowerCase()},new r};return{init:c}}}),Hilary.scope("keypsee").register({name:"KeyInfo",factory:function(){"use strict";var a;return a=function(a){var b=this;a=a||{},b.key=a.key,b.modifiers=a.modifiers,b.eventType=a.eventType,"undefined"!=typeof a.matchAnyModifier?b.matchAnyModifier=a.matchAnyModifier:b.matchAnyModifier=!1}}}),Hilary.scope("keypsee").register({name:"maps",factory:function(){"use strict";var a,b,c,d,e,f,g,h,i={};for(h=function(){var a=this;a.map=b,a.keycodeMap=c,a.shiftMap=d,a.reverseMap=e,a.aliases=g,a.getReverseMap=f,a.callbackMap=i,a.dispose=function(){delete a.callbackMap,i={},a.callbackMap=i}},b={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},c={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},d={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},g={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},a=1;20>a;a+=1)b[111+a]="f"+a;for(a=0;9>=a;a+=1)b[a+96]=a;return f=function(){if(!e){var a;e={};for(a in b)!b.hasOwnProperty(a)||a>95&&112>a||(e[b[a]]=a)}return e},new h}}),Hilary.scope("keypsee").register({name:"observer",dependencies:["utils","Callback","PasteObject","JSON"],factory:function(a,b,c,d){"use strict";var e,f,g,h,i,j,k,l,m,n=!1;return m=function(){var b=this;b.start=function(a){return n?b:(l=a,i(document),n=!0,b)},b.observeDomEvent=h,b.observeKeyEvents=i,b.observe=function(c,d,f,g){return c=a.isArray(c)?c:[c],a.isFunction(f)?e(c,d,!1,f):e(c,d,f,g),b},b.stopObserving=j,b.trigger=function(a){k(a)},b.getMaps=function(){return l.maps},b.dispose=function(){l.dispose()}},e=function(a,b,c,d){var e,h;for(h=0;h<a.length;h+=1)e=a[h],"paste"===e?g(d):f(e,b,c,d)},f=function(a,c,d,e){var f,g=l.getKeyInfo(a,c);g.matchAnyModifier=d,f=new b({key:a,keyInfo:g,callback:e,eventType:c}),l.registerCallback(g,f)},g=function(a){var e,f=l.getKeyInfo("paste","void");e=new b({key:"paste",keyInfo:f,callback:a,eventType:"void"}),l.registerCallback(f,e),void 0!==document.onpaste&&(document.onpaste=function(a){var b,e,g,h,i={items:[],json:""};e=(a.clipboardData||a.originalEvent.clipboardData).items,i.json=d.stringify(e);for(b in e)e.hasOwnProperty(b)&&(g=e[b],h=new c({kind:g.kind,type:g.type}),"file"===g.kind&&g.getAsFile&&(h.file=g.getAsFile(),h.readToDataUrl()),i.items.push(h));l.executePasteCallback(f,a,i)})},j=function(a,b){throw new Error("stopObserving is not implemented")},k=function(a){var b=l.getKeyInfoFromEvent(a);b.key&&l.executeCallback(b,a)},h=function(b,c){return a.observeDomEvent(b,c,k),this},i=function(a){return h(a,"keypress"),h(a,"keydown"),h(a,"keyup"),this},new m}}),Hilary.scope("keypsee").register({name:"PasteObject",dependencies:["FileReader"],factory:function(a){"use strict";var b;return b=function(b){var c=this;b=b||{},c.kind=b.kind,c.type=b.type,c.file=b.file,c.dataUrl=b.dataUrl,c.toDataUrl=function(){if(a){var b=new a;return b.onload=function(a){c.dataUrl=a.target.result},b.readAsDataURL(c.file)}}}}}),Hilary.scope("keypsee").register({name:"utils",factory:function(){"use strict";var a,b,c,d,e,f,g,h=Object.prototype,i=h.toString,j=(h.hasOwnProperty,{}),k=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"];return g=function(){var d,g,h=this;for(g=0;g<k.length;g+=1)d=k[g],j["[object "+d+"]"]=d.toLowerCase();h.preventDefault=a,h.stopPropagation=b,h.observeDomEvent=c,h.isArray=e,h.isFunction=f},a=function(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)},b=function(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)},c=function(a,b,c){return a.addEventListener?void a.addEventListener(b,c,!1):void a.attachEvent("on"+b,c)},d=function(a){return"undefined"==typeof a?"undefined":null===a?String(a):"object"==typeof a||"function"==typeof a?j[i.call(a)]||"object":typeof a},e=function(a){return"array"===d(a)},f=function(a){return"function"===d(a)},new g}}),function(a,b){"use strict";!function(){b.register({name:"FileReader",factory:function(){return FileReader}}),b.register({name:"JSON",factory:function(){return JSON}}),b.register({name:"console",factory:function(){return console}})}(),a.Keypsee=function(){var a=b.resolve("maps"),c=b.resolve("helpers").init(a);return b.resolve("observer").start(c)}}(window,Hilary.scope("keypsee"));