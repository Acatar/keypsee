/*! keypsee-build 2015-05-12 */
Hilary.scope("keypsee").register({name:"Callback",dependencies:["KeyInfo","console"],factory:function(a,b){"use strict";var c;return c=function(c){var d=this;c=c||{},d.key=c.key,d.keyInfo=c.keyInfo||new a,d.func=c.callback||function(a,c){b.log("event",a),b.log("keyInfo",c)},d.eventType=c.eventType}}}),Hilary.scope("keypsee").register({name:"helpers",dependencies:["utils","KeyInfo"],factory:function(a,b){"use strict";var c=function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return s=function(){var a=this;a.registerCallback=e,a.removeCallback=f,a.executePasteCallback=g,a.executeCallback=i,a.getKeyInfo=l,a.getKeyInfoFromEvent=m,a.maps=c,a.dispose=function(){c.dispose(),delete a.maps,a.maps=c}},d=function(a){return a.key+"::"+a.eventType},e=function(a,b){var e,f=d(a);e=c.callbackMap[f],e?e.push(b):c.callbackMap[f]=[b]},f=function(a){var b=d(a);return c.callbackMap[b]?(delete c.callbackMap[b],!0):!1},g=function(a,b,e){var f,g;if(g=c.callbackMap[d(a)])for(f=0;f<g.length;f+=1)h(a,b,g[f],e)},h=function(b,c,d,e){a.isFunction(d.func)&&d.func(c,b,e)},i=function(a,b){var e,f;if(f=c.callbackMap[d(a)])for(e=0;e<f.length;e+=1)j(a,b,f[e])},j=function(b,c,d){k(b,d.keyInfo)&&a.isFunction(d.func)&&d.func(c,b)===!1&&(a.preventDefault(c),a.stopPropagation(c))},k=function(a,b){var c,d=!0;if(a.modifiers.length!==b.modifiers.length)return!1;for(c=0;c<a.modifiers.length;c+=1)d=b.modifiers.indexOf(a.modifiers[c])>-1?d&&!0:!1;return d},l=function(a,d){var e,f,g,h=[];for(f=n(a),g=0;g<f.length;g+=1)e=f[g],c.aliases[e]&&(e=c.aliases[e]),d&&"keypress"!==d&&c.shiftMap[e]&&(e=c.shiftMap[e],h.push("shift")),o(e)&&h.push(e);return d=q(e,h,d),new b({key:e,modifiers:h,eventType:d})},m=function(a){"number"!=typeof a.which&&(a.which=a.keyCode);var c=r(a);if(c)return new b({key:c,modifiers:p(a),eventType:a.type})},n=function(a){if("+"===a)return["+"];var b,c=a.split("+");if(a.indexOf("plus")>-1)for(b=0;b<c.length;b+=1)"plus"===c[b]&&(c[b]="+");return c},o=function(a){return"shift"===a||"ctrl"===a||"alt"===a||"meta"===a},p=function(a){var b=[];return a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),a.shiftKey&&b.push("shift"),b},q=function(a,b,d){return d||(d=c.getReverseMap()[a]?"keydown":"keypress"),"keypress"===d&&b.length&&(d="keydown"),d},r=function(a){if("keypress"===a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase()),b}return c.map[a.which]?c.map[a.which]:c.keycodeMap[a.which]?c.keycodeMap[a.which]:String.fromCharCode(a.which).toLowerCase()},new s};return{init:c}}}),Hilary.scope("keypsee").register({name:"KeyInfo",factory:function(){"use strict";var a;return a=function(a){var b=this;a=a||{},b.key=a.key,b.modifiers=a.modifiers,b.eventType=a.eventType}}}),Hilary.scope("keypsee").register({name:"maps",factory:function(){"use strict";var a,b,c,d,e,f,g,h,i={};for(h=function(){var a=this;a.map=b,a.keycodeMap=c,a.shiftMap=d,a.aliases=g,a.getReverseMap=f,a.callbackMap=i,a.dispose=function(){delete a.callbackMap,i={},a.callbackMap=i}},b={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},c={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},d={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},g={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},a=1;20>a;a+=1)b[111+a]="f"+a;for(a=0;9>=a;a+=1)b[a+96]=a;return f=function(){if(!e){var a;e={};for(a in b)!b.hasOwnProperty(a)||a>95&&112>a||(e[b[a]]=a)}return e},new h}}),Hilary.scope("keypsee").register({name:"observer",dependencies:["PasteObserver","utils","Callback","PasteObject","JSON"],factory:function(a,b,c,d,e){"use strict";var f,g,h,i,j,k,l,m=!1;return l=function(){var c,d,e=this;e.init=function(b){return m?e:(j=b.helpers,c(b.DOMElement),m=!0,k=new a(b),e.observePaste=k.observePaste,e)},e.observe=function(a,c,d){var g;return g=b.isObject(a)?a:{keys:b.isArray(a)?a:[a],eventType:c||"keypress",callback:d},f(g.keys,g.eventType,g.callback),e},e.observeOnce=function(a,b,c){var d=function(d,f,g){c(d,f,g),e.stopObserving(a,b)};return e.observe(a,b,d)},e.observePaste=void 0,e.stopObserving=function(a,b){var c={};return h(a,function(a){var d=j.getKeyInfo(a,b);c[a]={removed:j.removeCallback(d)}}),c},e.dispose=function(){j.dispose()},e.trigger=function(a){if("string"==typeof a){var c={type:"keydown",bubbles:!0,cancelable:!0,"char":"B",key:"b",ctrlKey:!0,keyCode:66};i(c)}else{if(!b.isObject(a))throw new Error("Unable to trigger the event");i(a)}},e.getMaps=function(){return j.maps},e.eventHelpers={preventDefault:b.preventDefault,stopPropagation:b.stopPropagation},d=function(a,c){return b.observeDomEvent(a,c,i),e},c=function(a){return d(a,"keypress"),d(a,"keydown"),d(a,"keyup"),e}},h=function(a,c){if(!b.isFunction(c))throw new Error("The handler must be a function");var d;for(d=0;d<a.length;d+=1)c(a[d])},f=function(a,b,c){h(a,function(a){g(a,b,c)})},g=function(a,b,d){var e,f=j.getKeyInfo(a,b);e=new c({key:a,keyInfo:f,callback:d,eventType:b}),j.registerCallback(f,e)},i=function(a){var b=j.getKeyInfoFromEvent(a);b.key&&j.executeCallback(b,a)},new l}}),Hilary.scope("keypsee").register({name:"PasteObject",dependencies:["FileReader"],factory:function(a){"use strict";var b;return b=function(b){var c=this;b=b||{},c.kind=b.kind,c.type=b.type,c.file=b.file,c.data=b.data,c.dataUrl=b.dataUrl,c.toDataUrl=function(){if(a){var b=new a;return b.onload=function(a){c.dataUrl=a.target.result},b.readAsDataURL(c.file)}}}}}),Hilary.scope("keypsee").register({name:"PasteObserver",dependencies:["utils","Callback","PasteObject","JSON"],factory:function(a,b,c,d){"use strict";var e,f,g,h,i,j,k,l,m,n,o={maxAttempts:9e3,attemptInterval:10};return n=function(b){var c=this;f=b.helpers,g=b.DOMElement,b.pollingSettings&&"number"==typeof b.pollingSettings.maxAttempts&&"number"==typeof b.pollingSettings.attemptInterval&&(o=b.pollingSettings),c.observePaste=function(b){if(!a.isObject(b)||!a.isFunction(b.asyncCallback))throw new Error("An object literal with at least a callback property is required to call observePaste");b.syncCallback=b.syncCallback||h,e(b.asyncCallback,b.syncCallback)}},h=function(b){a.preventDefault(b),a.stopPropagation(b)},e=function(a,c){var d,e,h,i,j=void 0!==g.onpaste?g:document;if(void 0===j.onpaste)throw new Error("<KeypseeIncompatibilityError>: this browser does not support the onpaste event");d=f.getKeyInfo("paste","async"),h=f.getKeyInfo("paste","sync"),e=new b({key:"paste",keyInfo:d,callback:a,eventType:"async"}),i=new b({key:"paste",keyInfo:h,callback:c,eventType:"sync"}),f.registerCallback(d,e),f.registerCallback(h,i),j.onpaste=l(d,h)},i=function(a,b,c){var d;for(d in a)a.hasOwnProperty(d)&&a[d].kind&&a[d].type&&j(a[d],b,c)},j=function(a,b,d){var e=new c({kind:a.kind,type:a.type});"file"===a.kind&&a.getAsFile?(b.push({item:e,property:"dataUrl"}),e.file=a.getAsFile(),e.toDataUrl()):a.getData?(b.push({item:e,property:"data"}),e.data=a.getData(e.type)):a.getAsString&&(b.push({item:e,property:"data"}),a.getAsString(function(a){e.data=a})),d.items.push(e)},k=function(a){return function(){var b,c=!0;for(b=0;b<a.length;b+=1)c=void 0!==typeof a[b].item[a[b].property]?c&&!0:!1;return c}},l=function(a,b){return function(c){var e,g,h=[],j=k(h),l={items:[],json:""};e=(c.clipboardData||c.originalEvent.clipboardData).items,l.json=d.stringify(e),g=function(){f.executePasteCallback(a,c,l)},i(e,h,l),f.executePasteCallback(b,c,l),h.length>0?m(j,g,0,o.maxAttempts,o.attemptInterval):g()}},m=function(a,b,c,d,e){return"function"!=typeof a||"function"!=typeof b?!1:d>c?void setTimeout(function(){return a()?(c=0,b()):(c+=1,m(a,b,c,d,e))},e):(c=0,!1)},n}}),Hilary.scope("keypsee").register({name:"utils",factory:function(){"use strict";var a,b,c,d,e,f,g,h,i,j=Object.prototype,k=j.toString,l=(j.hasOwnProperty,{}),m=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"];return i=function(){var d,i,j=this;for(i=0;i<m.length;i+=1)d=m[i],l["[object "+d+"]"]=d.toLowerCase();j.preventDefault=a,j.stopPropagation=b,j.observeDomEvent=c,j.isArray=e,j.isFunction=f,j.isBoolean=g,j.isObject=h},a=function(a){return a.preventDefault?void a.preventDefault():void(a.returnValue=!1)},b=function(a){return a.stopPropagation?void a.stopPropagation():void(a.cancelBubble=!0)},c=function(a,b,c){if(a.addEventListener)return void a.addEventListener(b,c,!1);if(!a.attachEvent)throw new Error("<KeypseeIncompatibilityError>: This browser does not support addEventListener or attachEvent.");a.attachEvent("on"+b,c)},d=function(a){return"undefined"==typeof a?"undefined":null===a?String(a):"object"==typeof a||"function"==typeof a?l[k.call(a)]||"object":typeof a},e=function(a){return"array"===d(a)},f=function(a){return"function"===d(a)},g=function(a){return"boolean"===d(a)},h=function(a){return"object"===d(a)},new i}}),function(a,b){"use strict";!function(){b.register({name:"FileReader",factory:function(){return FileReader}}),b.register({name:"JSON",factory:function(){return JSON}}),b.register({name:"console",factory:function(){return console}})}(),a.Keypsee=function(a){a=a||{};var c=b.resolve("maps"),d=b.resolve("helpers").init(c);return b.resolve("observer").init({helpers:d,DOMElement:a.DOMElement||document,pollingSettings:a.pollingSettings})}}(window,Hilary.scope("keypsee"));